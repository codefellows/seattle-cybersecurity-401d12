<!-- .element class="main-title" -->
# Ops 401: Cybersecurity Engineering

<br>

## Class 16

NOTE:
This slide deck is used to introduce the day's class in the context of the overall course. Use this deck to facilitate the daily discussion of what we did yesterday, what we're about to do today, and what we'll be doing in the next class.

---

<!-- .element class="title-and-subtitle" -->
# Agenda

## Class 16 - IAM with AWS

- Course Overview<!-- .element: class="fragment highlight-current-red" data-fragment-index="1" -->
- Warmup
- Ops Challenge
- Review
  - Brute Force Attacks
- Lecture
  - IAM with AWS
- Demo

---

<!-- .element class="split-screen-with-title" -->
## Course Overview: Modules

<div>

<div align="left" style="font-size: 40px">

- **Module 1** - Governance, Risk and Compliance (GRC)

- **Module 2** - Data Security

- **Module 3** - Security Operations

- &shy;<!-- .element: class="fragment highlight-current-red" data-fragment-index="1" -->**Module 4** - Cloud Security

- **Module 5** - Midterm Project

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/00_01.png)
<!-- .element style="width: 100%"-->
Source: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Kali-dragon-icon.svg)

</div>

</div>

---

<!-- .element class="title-with-text" -->
# Module 4 Labs

### Cloud Security

<div align="left" style="font-size: 45px">

- &shy;<!-- .element style="color: red;" -->**Class 16** - Cloud IAM

<br>

- **Class 17** - Cloud Network Security

<br>

- **Class 18** - Cloud Logging and Monitoring

<br>

- **Class 19** - Cloud Detective Controls

<br>

- **Class 20** - Midterm Project Kickoff

</div>

---

<!-- .element class="split-screen-with-title" -->
# Module 4 Challenges

<div>

<div align="left" style="font-size: 38px">

- &shy;<!-- .element style="color: red;" -->**Class 16** - Brute Force Attack Tool Pt. 1 of 3

<br>

- **Class 17** - Brute Force Attack Tool Pt. 2 of 3

<br>

- **Class 18** - Brute Force Attack Tool Pt. 3 of 3

<br>

- **Class 19** - Mock Interviews

<br>

- **Class 20** - N/A

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/00_02.png)

</div>

</div>

---

<!-- .element class="main-title" -->
# Warmup

---

<!-- .element class="main-title" -->
# Ops Challenge

---

<!-- .element class="main-title" -->
# Review:

## Brute Force Attacks

---

<!-- .element class="split-screen-with-title" -->
# Rainbow Tables

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**What is a rainbow table?**
  - A precomputed dictionary of plaintext passwords and their corresponding hash values
  - Can be used to find out what plaintext password produces a particular hash <!-- .element: class="fragment" data-fragment-index="2" -->
  - Much faster to query <!-- .element: class="fragment" data-fragment-index="3" -->
  - Hashing methods determine table type <!-- .element: class="fragment" data-fragment-index="4" -->
  - Don't work on “salted” hashes <!-- .element: class="fragment" data-fragment-index="5" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/15_03.png)
Source: Wikipedia - Rainbow Table

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# Salting

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**What is Salting?**
  - Salting is a cryptographic technique that protects passwords against rainbow tables by adding random characters to the plaintext prior to hashing. <!-- .element: class="fragment" data-fragment-index="2" -->
  - Generates a totally different hash <!-- .element: class="fragment" data-fragment-index="3" -->
  - Each user should have a unique salt value <!-- .element: class="fragment" data-fragment-index="4" -->
  - Salt is generated by a cryptographically secure pseudo-random number generator <!-- .element: class="fragment" data-fragment-index="5" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/15_04.png)
Source: Guiding Tech

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# Dictionary Attacks

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**What is a dictionary attack?**
  - A type of brute force attack where an intruder attempts to crack a password-protected security system with a “dictionary list” of common words and phrases <!-- .element: class="fragment" data-fragment-index="2" -->
  - Increase odds of success by playing towards human tendencies in password creation <!-- .element: class="fragment" data-fragment-index="3" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/15_05.png)
Source: The Guardian

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# Module 4 Objectives

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**Understand IAM Fundamentals**
  - Users
  - Groups
  - Roles
  - Policies
- &shy;<!-- .element: class="fragment" data-fragment-index="2" -->**Implement Secure Access Controls**
- &shy;<!-- .element: class="fragment" data-fragment-index="3" -->**Manage Identity Services**
- &shy;<!-- .element: class="fragment" data-fragment-index="4" -->**Automate IAM Workflows**

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_01.png)

</div>

</div>

---

<!-- .element class="main-title" -->
# Cloud IAM with AWS

---

<!-- .element class="split-screen-with-title" -->
# IAM: A High Level View

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**User Authentication:** IAM verifies user identities through methods like passwords and biometrics.
- &shy;<!-- .element: class="fragment" data-fragment-index="2" -->**Access Control:** IAM determines user access to resources based on roles and permissions.
- &shy;<!-- .element: class="fragment" data-fragment-index="3" -->**Least Privilege:** IAM follows the principle of least privilege to limit access to what's necessary.
- &shy;<!-- .element: class="fragment" data-fragment-index="4" -->**Account Management:** IAM covers account creation, modification, and removal, ensuring proper account lifecycle management.

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_01.png)

</div>

</div>

NOTE:

- What is IAM? According to ISC2:
  - 5.1 Control physical and logical access to assets
    - Information
    - Systems
    - Devices
    - Facilities
  - 5.2 Manage identification and authentication of people, devices, and services
    - Identity management implementation
    - Single/multi-factor authentication
    - Accountability
    - Session management
    - Registration and proofing of identity
    - Federated Identity Management (FIM)
    - Credential management systems
  - 5.3 Integrate identity as a third-party service
    - On-premise
    - Cloud
    - Federated
  - 5.4 Implement and manage authorization mechanisms
    - Role Based Access Control (RBAC)
    - Rule-based access control
    - Mandatory Access Control (MAC)
    - Discretionary Access Control (DAC)
    - Attribute Based Access Control (ABAC)
  - 5.5 Manage the identity and access provisioning lifecycle
    - User access review
    - System account access review
    - Provisioning and deprovisioning

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**Why should we practice AWS IAM controls?**
  - IAM users, roles and policies determine what user accounts are allowed to do <!-- .element: class="fragment" data-fragment-index="2" -->
  - Administrator clearances are the primary targets of threat actors (privilege escalation) <!-- .element: class="fragment" data-fragment-index="3" -->
- &shy;<!-- .element: class="fragment" data-fragment-index="4" -->**Example: Capital One data breach**
  - Metadata service had a server side request forgery (SSRF) vulnerability <!-- .element: class="fragment" data-fragment-index="5" -->
  - IAM admin role a major part of this <!-- .element: class="fragment" data-fragment-index="6" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_02.png)
Source: gbhackers

</div>

</div>

NOTE:
"On July 29, 2019, the FBI arrested Paige A. Thompson (also known by the alias “erratic”) for allegedly hacking into Capital One databases and stealing the data. CapitalOne disclosed the estimated the data loss at approximately 1 million Social Insurance Numbers of Canadian credit card customers, about 140,000 Social Security numbers and 80,000 linked bank account numbers of the credit card customers" -Cloudneeti

The attacker exploited a SSRF vulnerability. The IAM configuration of this cloud infrastructure, along with exploiting the new metadata service, played a key role in allowing the attack to succeed.

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**What does the AWS IAM service do?**
  - Enables centralized control over access to AWS resources <!-- .element: class="fragment" data-fragment-index="2" -->
  - Allows us to create and manage users, groups, and roles <!-- .element: class="fragment" data-fragment-index="3" -->
  - Detailed logging and auditing of user activity <!-- .element: class="fragment" data-fragment-index="4" -->
  - Used for security and compliance best practices <!-- .element: class="fragment" data-fragment-index="5" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_03.png)
Source: foxutech

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Objects

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**IAM objects include**
  - Users <!-- .element: class="fragment" data-fragment-index="2" -->
  - Groups <!-- .element: class="fragment" data-fragment-index="3" -->
  - Roles <!-- .element: class="fragment" data-fragment-index="4" -->
  - Policies <!-- .element: class="fragment" data-fragment-index="5" -->
    - ARN <!-- .element: class="fragment" data-fragment-index="6" -->
    - Principal <!-- .element: class="fragment" data-fragment-index="7" -->
    - Actions <!-- .element: class="fragment" data-fragment-index="8" -->
    - Conditions <!-- .element: class="fragment" data-fragment-index="9" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_04.png)
Source: Cloudberry Lab

</div>

</div>

NOTE:

- What IAM concepts are unique to AWS IAM?
  - Principals
    - Specifies the user, account, service, or other entity that is allowed or denied access to a resource
  - Root Users
    - Root users in AWS can perform all actions
  - IAM Users
    - Users can belong to multiple user groups
  - IAM Groups
    - A collection of IAM users
    - Contain many users
    - Can't be nested (no groups inside groups)

---

<!-- .element class="image-and-title" -->
# AWS IAM

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_05.png)
Source: Medium

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Users

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**AWS root user**
  - Has complete and unrestricted access to all AWS resources <!-- .element: class="fragment" data-fragment-index="2" -->
  - Critical to secure the root account with a strong, unique password and MFA <!-- .element: class="fragment" data-fragment-index="3" -->
  - Root account access should be rare and reserved for critical changes <!-- .element: class="fragment" data-fragment-index="4" -->
  - Regular IAM users with appropriate permissions should be used for most day to day activities <!-- .element: class="fragment" data-fragment-index="4" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_06.png)
Source: AWS Documentation

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Groups

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**IAM Group**
  - A collection of IAM users. <!-- .element: class="fragment" data-fragment-index="2" -->
  - Can contain many users, and a user can belong to multiple user groups <!-- .element: class="fragment" data-fragment-index="3" -->
  - Can't be nested (no groups inside groups) <!-- .element: class="fragment" data-fragment-index="4" -->
  - Can't be identified as a “Principal” <!-- .element: class="fragment" data-fragment-index="5" -->
  - Example: <!-- .element: class="fragment" data-fragment-index="6" -->
    - Group called “Admins” with permissions that administrators need <!-- .element: class="fragment" data-fragment-index="7" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_07.png)
Source: AWS Documentation

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Roles

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**What is an IAM role?**
  - An entity that defines a set of permissions for making AWS service requests <!-- .element: class="fragment" data-fragment-index="2" -->
- &shy;<!-- .element: class="fragment" data-fragment-index="3" -->**What do IAM roles do?**
  - Roles allow you to grant temporary permissions to users, services, or applications without sharing long-term access keys. <!-- .element: class="fragment" data-fragment-index="4" -->
  - &shy;<!-- .element: class="fragment" data-fragment-index="5" -->**Example:**
    - Role access between production and development environments <!-- .element: class="fragment" data-fragment-index="6" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_08.png)

Source: AWS Documentation

</div>

</div>

NOTE:

- IAM Roles
  - Similar to users but instead of being associated with one person, a role is intended to be assumed by anyone who needs it
  - Does not have standard long-term credentials (passwords or access keys)
  - When you assume a role, it gives you temporary security credentials for your role session

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Policies

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**Inline policy**
  - A policy that's embedded in an IAM identity (a user, group, or role)
  - Policy is an inherent part of the identity <!-- .element: class="fragment" data-fragment-index="2" -->
  - Specific to a single identity and can't be detached or reused <!-- .element: class="fragment" data-fragment-index="3" -->
- &shy;<!-- .element: class="fragment" data-fragment-index="4" -->**AWS managed policy**
  - A standalone policy that is created and administered by AWS <!-- .element: class="fragment" data-fragment-index="5" -->
  - &shy;<!-- .element: class="fragment" data-fragment-index="6" -->Standalone policies have their own **Amazon Resource Name (ARN)** that includes the policy name

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_09.png)
Source: AWS Documentation

</div>

</div>

NOTE:

“Inline policies are useful if you want to maintain a strict one-to-one relationship between a policy and the identity that it's applied to. For example, you want to be sure that the permissions in a policy are not inadvertently assigned to an identity other than the one they're intended for.”

“This diagram illustrates inline policies. Each policy is an inherent part of the user, group, or role. Notice that two roles include the same policy (the DynamoDB-books-app policy), but they are not sharing a single policy; each role has its own copy of the policy.”

- Policy documents
  - Identity-based policies
    - Inline Policy
    - Customer-Managed Policy
    - AWS-Managed Policy
  - S3 Policies
    - ACL
    - Bucket

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Policies

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**IAM policy objects**
  - Stored in JSON documents <!-- .element: class="fragment" data-fragment-index="2" -->
  - Used to control access to AWS services and resources <!-- .element: class="fragment" data-fragment-index="3" -->
- &shy;<!-- .element: class="fragment" data-fragment-index="4" -->**IAM policy elements**
  - &shy;<!-- .element: class="fragment" data-fragment-index="5" -->Sid
  - &shy;<!-- .element: class="fragment" data-fragment-index="6" -->Effect
  - &shy;<!-- .element: class="fragment" data-fragment-index="7" -->Action
  - &shy;<!-- .element: class="fragment" data-fragment-index="8" -->Resource

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_10.png)

</div>

</div>

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Policies

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->The following common **Amazon Resource Name (ARN)** format identifies resources in AWS:
  - Example: `arn:partition:service:region:namespace:relative-id` <!-- .element: class="fragment" data-fragment-index="2" -->
- The Principal element specifies the user, account, service, or other entity that is allowed or denied access to a resource. <!-- .element: class="fragment" data-fragment-index="3" -->
  - Example: <!-- .element: class="fragment" data-fragment-index="4" -->

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_11.png)

Source: AWS Documentation

NOTE:

The displayed example bucket policy grants the s3:PutObject and the s3:PutObjectAcl permissions to a user (Dave). If you remove the Principal element, you can attach the policy to a user. These are object operations. Accordingly, the relative-id portion of the Resource ARN identifies objects (awsexamplebucket1/*). For more information, see Amazon S3 resources.

---

<!-- .element class="split-screen-with-title" -->
# AWS IAM Policies

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**Actions** are keyword permissions that indicate what the user is allowed to do according to this policy.
- &shy;<!-- .element: class="fragment" data-fragment-index="2" -->**Conditions** use boolean operators to match your condition against values in the request.
- &shy;<!-- .element: class="fragment" data-fragment-index="3" -->**Resource-level permissions** can be specified in the resource types column

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_12.png)
Source: AWS Documentation

</div>

</div>

NOTE:

In the Condition element, you build expressions in which you use Boolean operators (equal, less than, etc.) to match your condition against values in the request. For example, when granting a user permission to upload an object, the bucket owner can require that the object be publicly readable by adding the StringEquals condition, as shown here.

- Source: AWS Documentation

---

<!-- .element class="split-screen-with-title" -->
# Interacting with AWS

<div>

<div>

- &shy;<!-- .element: class="fragment" data-fragment-index="1" -->**How can a user interact with AWS?**
  - AWS Management Console <!-- .element: class="fragment" data-fragment-index="2" -->
  - AWS Command Line Interface (CLI) <!-- .element: class="fragment" data-fragment-index="3" -->
    - Supports script execution <!-- .element: class="fragment" data-fragment-index="4" -->
- &shy;<!-- .element: class="fragment" data-fragment-index="5" -->**Free tier**
  - Review how free tier works <!-- .element: class="fragment" data-fragment-index="6" -->

</div>

<div>

![Image](/ops-401-cybersecurity-guide/curriculum/class-16/slides/assets/16_13.png)
Source: AWS Documentation

</div>

</div>

NOTE:

---

<!-- .element class="main-title" -->
# Demo

NOTE:

DO:

- Show students how to reference this today as they practice manipulating IAM objects in the AWS CLI.

In this demo, we'll show:

- How to differentiate root user and IAM user
- How to install and setup AWS CLI
- How to create a new user
- How to create a new group
- How to attach a managed policy to a group
- How to attach a user to a group
- How to differentiate root user and IAM user
  - At the login screen, explain the difference between root user and IAM user
- How to install and setup AWS CLI
  - Show how to install AWS CLI
  - Show where to find your AWS access key
  - In the navigation bar on the upper right, choose your user name, and then choose My Security Credentials.
  - Expand the Access keys (access key ID and secret access key) section.
  - To create an access key, choose Create New Access Key.
  - Mention AWS CLI is setup first time with aws config
  - Pull up your terminal
- How to create a new user
  - Show how to create a new user by entering aws iam create-user --user-name Bruce
  - This should return:

```
{
    "User": {
        "Path": "/",
        "UserName": "Bruce",
        "UserId": "ABCDEFGHIJKLMNOP",
        "Arn": "arn:aws:iam::1234567890:user/Bruce",
        "CreateDate": "2021-04-23T19:17:26+00:00"
    }
}
```

- Check user accounts with `aws iam list-users`
  - Navigate to the AWS web portal and type IAM into the search.
  - Pull up IAM and confirm the user Bruce was created.
- How to create a new group
  - Demonstrate how to create a group in the CLI by entering `aws iam create-group --group-name TestGroup1`

```
{
    "Group": {
        "Path": "/",
        "GroupName": "TestGroup1",
        "GroupId": "ABCDEFGHIJKLMNOP123123",
        "Arn": "arn:aws:iam::123123123123:group/TestGroup1",
        "CreateDate": "2021-04-23T22:42:08+00:00"
    }
}
```

- View the groups anytime with aws iam list-groups
- How to attach a managed policy to a group
  - Now it's time to attach a policy to the newly-created `TestGroup1`.
  - Review the policies in the web portal > IAM > Policies. Note the name of AmazonEC2FullAccess.
  - Type this into the console to attach this policy to our existing group, TestGroup1: `aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name TestGroup1`
  - Verify successful with `aws iam list-attached-group-policies --group-name EC2-Admin`

```
{
    "AttachedPolicies": [
        {
            "PolicyName": "AmazonEC2FullAccess",
            "PolicyArn": "arn:aws:iam::aws:policy/AmazonEC2FullAccess"
        }
    ]
}
```

- Create an inline policy
  - `aws iam put-group-policy --group-name EC2-Admin --policy-document file://AdminPolicy.json --policy-name AdminRoot`
- How to attach a user to a group
- Finally, let's add Bruce to `TestGroup1` with `aws iam add-user-to-group --user-name Bruce --group-name EC2-Admin`
- Validate Bruce's membership with `aws iam list-groups-for-user --user-name Bruce`
